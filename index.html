<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°–µ–º–µ–π–Ω—ã–π –±—é–¥–∂–µ—Ç</title>
    <link rel="stylesheet" href="style.css">
    <link rel="icon" type="image/x-icon" href="icons/favicon.ico">
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#007AFF">
    <link rel="manifest" href="/manifest.json">

    <!-- Apple Specific Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="–°–µ–º–µ–π–Ω—ã–π –±—é–¥–∂–µ—Ç">
    <link rel="apple-touch-icon" href="icons/icon-152x152.png">

    <!-- Preload critical resources -->
    <link rel="preload" href="style.css" as="style">
    <link rel="preload" href="app.js" as="script">
    
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div id="refresh-indicator" class="refresh-indicator"></div>
    <section id="auth-screen" class="auth-screen">
        <h2>üîê –í—Ö–æ–¥ –≤ –°–µ–º–µ–π–Ω—ã–π –±—é–¥–∂–µ—Ç</h2>
        <p>–í–≤–µ–¥–∏—Ç–µ email –∏ –ø–∞—Ä–æ–ª—å</p>
        <form id="login-form">
            <input type="email" id="login-email" placeholder="Email" required />
            <input type="password" id="login-password" placeholder="–ü–∞—Ä–æ–ª—å" required />
            <button type="submit" class="btn">–í–æ–π—Ç–∏</button>
            <p id="auth-error" style="color: red; margin-top: 10px;"></p>
        </form>
    </section>
    <header class="app-header">
        <button onclick="toggleTheme()" class="btn theme-toggle" title="–¢—ë–º–Ω–∞—è —Ç–µ–º–∞">
            <img src="icons/theme-icon.png" alt="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É" class="header-icon">
        </button>
        <h1 id="current-section-title">–ì–ª–∞–≤–Ω–∞—è</h1>
        <button onclick="logout()" class="btn logout-btn" title="–í—ã–π—Ç–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞">
            <img src="icons/logout-icon.png" alt="–í—ã–π—Ç–∏" class="header-icon">
        </button>
    </header>
    <div id="app" style="display: none;">
        <section id="home">
            <h2>–¶–µ–ª—å –Ω–∞–∫–æ–ø–ª–µ–Ω–∏–π</h2>
            <div class="goal-section">
                <label><strong>–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Ü–µ–ª—å:</strong></label>
                <div class="input-group">
                    <input type="number" id="savings-goal" value="500000" placeholder="500000" />
                    <button onclick="saveGoal()" class="btn small">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                </div>
            </div>
            <div class="stats-grid">
                <!-- –í—Å–µ–≥–æ –Ω–∞–∫–æ–ø–ª–µ–Ω–æ (–≤—Å–µ –∞–∫—Ç–∏–≤—ã) -->
                <div class="stat-card main-card">
                    <h3>–í—Å–µ–≥–æ –Ω–∞–∫–æ–ø–ª–µ–Ω–æ</h3>
                    <p class="value" id="total-savings">0 ‚ÇΩ</p>
                </div>
                <!-- –†—É–±–ª–µ–≤—ã–µ –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è -->
                <h2>–†—É–±–ª–µ–≤—ã–µ –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è</h2>
                <div class="stat-card ruble-savings-card">
                    <h3>–ù–∞–∫–æ–ø–ª–µ–Ω–æ —Ä—É–±–ª–µ–π</h3>
                    <p class="value" id="ruble-savings-amount">0 ‚ÇΩ</p>
                    <div class="inner-progress-bar">
                        <div id="ruble-progress-fill" class="inner-progress-fill"></div>
                    </div>
                    <p class="info" id="ruble-progress-text">0% –æ—Ç —Ü–µ–ª–∏</p>
                </div>
                <div class="stat-card">
                    <h3>–î–æ—Ö–æ–¥ –∑–∞ –º–µ—Å—è—Ü</h3>
                    <p class="value" id="monthly-income">0 ‚ÇΩ</p>
                </div>
                <div class="stat-card">
                    <h3>–†–∞—Å—Ö–æ–¥ –∑–∞ –º–µ—Å—è—Ü</h3>
                    <p class="value" id="monthly-expense">0 ‚ÇΩ</p>
                </div>
            </div>
            <!-- –ë–ª–æ–∫: –î–æ–ª–ª–∞—Ä–æ–≤—ã–µ –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è -->
            <h2>–î–æ–ª–ª–∞—Ä–æ–≤—ã–µ –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è</h2>
            <div class="stats-grid">
                <div class="stat-card dollar-card">
                    <h3>–ù–∞–∫–æ–ø–ª–µ–Ω–æ –¥–æ–ª–ª–∞—Ä–æ–≤</h3>
                    <p class="value" id="dollar-savings-amount">0 $</p>
                    <p class="info" id="dollar-rate">–ö—É—Ä—Å: –∑–∞–≥—Ä—É–∑–∫–∞...</p>
                </div>
                <div class="stat-card ruble-card">
                    <h3>–°—É–º–º–∞ –≤ —Ä—É–±–ª—è—Ö</h3>
                    <p class="value" id="dollar-savings-rub">0 ‚ÇΩ</p>
                    <p class="info">–ü–æ –∫—É—Ä—Å—É –¶–ë</p>
                </div>
            </div>
            <!-- –ö–æ–Ω–µ—Ü –±–ª–æ–∫–∞ -->
        </section>
        <section id="add" style="display: none;">
            <h2>–î–æ–±–∞–≤–∏—Ç—å –æ–ø–µ—Ä–∞—Ü–∏—é</h2>
            <form id="add-form">
                <input type="date" id="date" required />
                <input list="categories" id="category" placeholder="–ö–∞—Ç–µ–≥–æ—Ä–∏—è (–µ–¥–∞, —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç –∏ —Ç.–¥.)" required />
                <datalist id="categories"></datalist>
                <input type="number" id="amount" placeholder="–°—É–º–º–∞" step="0.01" required />
                <select id="type" required>
                    <option value="income">–î–æ—Ö–æ–¥</option>
                    <option value="expense">–†–∞—Å—Ö–æ–¥</option>
                </select>
                <input list="authors" id="author" placeholder="–ê–≤—Ç–æ—Ä" required />
                <datalist id="authors"></datalist>
                <input type="text" id="comment" placeholder="–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)" />
                <div class="toggle-container">
                    <div class="toggle-switch">
                        <input type="checkbox" id="dollar-savings" class="toggle-input" />
                        <label for="dollar-savings" class="toggle-label">
                            <span class="toggle-button"></span>
                        </label>
                    </div>
                    <span class="toggle-text">–î–æ–ª–ª–∞—Ä—ã</span>
                </div>
                <button type="submit" class="btn">–î–æ–±–∞–≤–∏—Ç—å</button>
            </form>
            <form id="edit-form" style="display: none;">
                <input type="hidden" id="edit-id" />
                <input type="date" id="edit-date" required />
                <input list="edit-categories" id="edit-category" placeholder="–ö–∞—Ç–µ–≥–æ—Ä–∏—è" required />
                <datalist id="edit-categories"></datalist>
                <input type="number" id="edit-amount" placeholder="–°—É–º–º–∞" step="0.01" required />
                <select id="edit-type" required>
                    <option value="income">–î–æ—Ö–æ–¥</option>
                    <option value="expense">–†–∞—Å—Ö–æ–¥</option>
                </select>
                <input list="edit-authors" id="edit-author" placeholder="–ê–≤—Ç–æ—Ä" required />
                <datalist id="edit-authors"></datalist>
                <input type="text" id="edit-comment" placeholder="–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π" />
                <div class="toggle-container">
                    <div class="toggle-switch">
                        <input type="checkbox" id="edit-dollar-savings" class="toggle-input" />
                        <label for="edit-dollar-savings" class="toggle-label">
                            <span class="toggle-button"></span>
                        </label>
                    </div>
                    <span class="toggle-text">–î–æ–ª–ª–∞—Ä—ã</span>
                </div>
                <button type="submit" class="btn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                <button type="button" onclick="cancelEdit()" class="btn secondary">–û—Ç–º–µ–Ω–∞</button>
            </form>
            <h3>–ü–æ—Å–ª–µ–¥–Ω–∏–µ 10 –æ–ø–µ—Ä–∞—Ü–∏–π</h3>
            <ul id="recent-transactions"></ul>
        </section>
        <section id="plan" style="display: none;">
            <h2>–§–∏–Ω–∞–Ω—Å–æ–≤—ã–π –ø–ª–∞–Ω</h2>
            <p>–ó–∞–ø–ª–∞–Ω–∏—Ä—É–π—Ç–µ –¥–æ—Ö–æ–¥—ã –∏ —Ä–∞—Å—Ö–æ–¥—ã –ø–æ –º–µ—Å—è—Ü–∞–º</p>
            <div class="card">
                <h3>–í–≤–µ—Å—Ç–∏ –≤—Ä—É—á–Ω—É—é</h3>
                <form id="plan-form">
                    <input type="month" id="plan-month" required />
                    <input type="number" id="plan-income" placeholder="–ü–ª–∞–Ω–∏—Ä—É–µ–º—ã–π –¥–æ—Ö–æ–¥ (‚ÇΩ)" step="0.01" required />
                    <input type="number" id="plan-expense" placeholder="–ü–ª–∞–Ω–∏—Ä—É–µ–º—ã–µ —Ä–∞—Å—Ö–æ–¥—ã (‚ÇΩ)" step="0.01" required />
                    <button type="submit" class="btn">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                </form>
            </div>
            <div class="card">
                <h3>üì• –ò–º–ø–æ—Ä—Ç –∏–∑ Excel</h3>
                <p class="excel-hint">–§–æ—Ä–º–∞—Ç: <code>–ú–µ—Å—è—Ü (–ì–ì–ì–ì-–ú–ú), –î–æ—Ö–æ–¥, –†–∞—Å—Ö–æ–¥</code></p>
                <input type="file" id="import-plan-file" accept=".xlsx, .xls" class="file-input" />
                <button onclick="importPlanFromExcel()" class="btn small">–ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
            </div>
            <h3>–¢–µ–∫—É—â–∏–µ –ø–ª–∞–Ω—ã</h3>
            <ul id="plan-list"></ul>
        </section>
        <section id="analytics" style="display: none;">
            <h2>–û—Ç—á–µ—Ç</h2>
            <div class="card">
                <h3>üìä –§–∏–Ω–∞–Ω—Å–æ–≤—ã–π –ø–ª–∞–Ω –Ω–∞ –º–µ—Å—è—Ü</h3>
                <p><strong>–¢–µ–∫—É—â–∏–π –º–µ—Å—è—Ü:</strong> <span id="current-month">–ó–∞–≥—Ä—É–∑–∫–∞...</span></p>
                <p><strong>–î–æ—Ö–æ–¥ (–ø–ª–∞–Ω):</strong> <span id="plan-income-value">‚Äî ‚ÇΩ</span></p>
                <p><strong>–î–æ—Ö–æ–¥ (—Ñ–∞–∫—Ç):</strong> <span id="fact-income-value">0 ‚ÇΩ</span></p>
                <div class="progress-bar"><div id="progress-income-bar" class="progress-fill"></div></div>
                <p><strong>–†–∞—Å—Ö–æ–¥ (–ø–ª–∞–Ω):</strong> <span id="plan-expense-value">‚Äî ‚ÇΩ</span></p>
                <p><strong>–†–∞—Å—Ö–æ–¥ (—Ñ–∞–∫—Ç):</strong> <span id="fact-expense-value">0 ‚ÇΩ</span></p>
                <div class="progress-bar"><div id="progress-expense-bar" class="progress-fill"></div></div>
            </div>
            <div class="card">
                <h3>üìä –ò—Ç–æ–≥–∏</h3>
                <p><strong>–î–æ—Ö–æ–¥—ã:</strong> <span id="analytics-income">0 ‚ÇΩ</span></p>
                <p><strong>–†–∞—Å—Ö–æ–¥—ã:</strong> <span id="analytics-expense">0 ‚ÇΩ</span></p>
                <p><strong>–ù–∞–∫–æ–ø–ª–µ–Ω–æ –≤ —ç—Ç–æ–º –º–µ—Å—è—Ü–µ:</strong> <span id="monthly-savings">0 ‚ÇΩ</span></p>
            </div>
            <div class="card">
                <h3>üìâ –¢–æ–ø-3 —Å—Ç–∞—Ç—å–∏ —Ä–∞—Å—Ö–æ–¥–æ–≤</h3>
                <ul id="top-expenses"></ul>
            </div>
            <h2>üìä –ê–Ω–∞–ª–∏–∑</h2>
            <div class="card">
                <h3>üìÖ –í—ã–±–µ—Ä–∏—Ç–µ –ø–µ—Ä–∏–æ–¥</h3>
                <div class="bi-filter">
                    <input type="date" id="bi-start-date" />
                    <input type="date" id="bi-end-date" />
                    <button onclick="updateBI()" class="btn small">–ü–æ–∫–∞–∑–∞—Ç—å</button>
                </div>
            </div>
            <div class="chart-container">
                <h3>üìâ –†–∞—Å—Ö–æ–¥—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º</h3>
                <canvas id="expensePieChart"></canvas>
            </div>
            <div class="chart-container fixed-height">
                <h3>üìà –†–æ—Å—Ç –Ω–∞–∫–æ–ø–ª–µ–Ω–∏–π –ø–æ –Ω–µ–¥–µ–ª—è–º</h3>
                <canvas id="savingsWeeklyChart"></canvas>
            </div>
        </section>
        <section id="list" style="display: none;">
            <h2>üìã –ò—Å—Ç–æ—Ä–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π</h2>
            <div class="filter-section">
                <input type="date" id="filter-start" placeholder="–° –¥–∞—Ç—ã" />
                <input type="date" id="filter-end" placeholder="–ü–æ –¥–∞—Ç—É" />
                <button onclick="filterByDate()" class="btn">üîç –§–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å</button>
                <button onclick="clearFilter()" class="btn secondary">–°–±—Ä–æ—Å–∏—Ç—å</button>
                <button onclick="exportToExcel()" class="btn">üì§ –≠–∫—Å–ø–æ—Ä—Ç</button>
            </div>
            <ul id="all-transactions"></ul>
        </section>
        <nav class="bottom-nav">
            <button onclick="show('home')" class="nav-btn">
                <img src="icons/home-icon.png" alt="–ì–ª–∞–≤–Ω–∞—è" class="nav-icon">
                <span>–ì–ª–∞–≤–Ω–∞—è</span>
            </button>
            <button onclick="show('plan')" class="nav-btn">
                <img src="icons/plan-icon.png" alt="–ü–ª–∞–Ω" class="nav-icon">
                <span>–ü–ª–∞–Ω</span>
            </button>
            <button onclick="show('add')" class="nav-btn">
                <img src="icons/add-icon.png" alt="–î–æ–±–∞–≤–∏—Ç—å" class="nav-icon">
                <span>–î–æ–±–∞–≤–∏—Ç—å</span>
            </button>
            <button onclick="show('analytics')" class="nav-btn">
                <img src="icons/analytics-icon.png" alt="–û—Ç—á–µ—Ç" class="nav-icon">
                <span>–û—Ç—á–µ—Ç</span>
            </button>
            <button onclick="show('list')" class="nav-btn">
                <img src="icons/list-icon.png" alt="–ò—Å—Ç–æ—Ä–∏—è" class="nav-icon">
                <span>–ò—Å—Ç–æ—Ä–∏—è</span>
            </button>
        </nav>
    </div>
    <script src="app.js"></script>
</body>
</html>
